// Generated by CoffeeScript 1.6.1
(function() {
  var ChatController,
    _this = this;

  ChatController = (function() {

    function ChatController(data) {
      var _this = this;
      this.data = data;
      this.scrollChat = function() {
        return ChatController.prototype.scrollChat.apply(_this, arguments);
      };
      this.setStory = function(_message) {
        return ChatController.prototype.setStory.apply(_this, arguments);
      };
      this.onPost = function(data) {
        return ChatController.prototype.onPost.apply(_this, arguments);
      };
      this.onReception = function(data) {
        return ChatController.prototype.onReception.apply(_this, arguments);
      };
      this.me = 'Nicolas';
      this.messages = [];
      this.users = [];
      this.chat = $('#chat');
      $('#input input').on('keypress', function(e) {
        var _content;
        if (e.charCode === 13) {
          _content = $('#input input').val();
          _this.onPost({
            user: _this.me,
            content: _content
          });
          return $('#input input').val("");
        }
      });
      return this;
    }

    ChatController.prototype.onReception = function(data) {
      var _message;
      _message = new Message(data);
      this.messages.push(_message);
      this.chat.append(_message.html);
      this.setStory(_message);
      this.scrollChat();
    };

    ChatController.prototype.onPost = function(data) {
      now.postMessage(data);
      return this;
    };

    ChatController.prototype.setStory = function(_message) {
      var _lastMessage, _result;
      _result = false;
      _lastMessage = this.messages[this.messages.length - 2];
      if (_lastMessage != null) {
        if (_lastMessage.user === _message.user) {
          if (_lastMessage.getClass() === '') {
            _lastMessage.setClass('start');
          } else {
            _lastMessage.setClass('continue');
          }
          _message.setClass('end');
        } else {
          if (_lastMessage.getClass === 'continue') {
            _lastMessage.setClass('end');
          }
        }
      }
      return _result;
    };

    ChatController.prototype.scrollChat = function() {
      var elem;
      elem = document.getElementById('chat');
      elem.scrollTop = elem.scrollHeight;
    };

    return ChatController;

  })();

  window.ChatController = ChatController;

}).call(this);
